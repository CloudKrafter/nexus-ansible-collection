- name: Wait for Nexus API
  ansible.builtin.uri:
    url: "http://localhost:8081/service/rest/v1/status"
    method: GET
    status_code: 200
  register: result
  until: result.status == 200
  retries: 60
  delay: 5

- name: Gather Nexus information
  cloudkrafter.nexus.gather_info:
    url: http://localhost:8081
    username: admin
    password: changeme
    validate_certs: false
  register: nexus_data

- name: Print Nexus information
  vars:
    info: |-
      Version: {{ ansible_facts.nexus.version }}
      Edition: {{ ansible_facts.nexus.edition }}
      Node ID: {{ ansible_facts.nexus.node_id }}
      Details: {{ ansible_facts.nexus.details | bool }}
  ansible.builtin.debug:
    msg: "{{ info.split('\n') }}"

- name: Print nexus_data vars
  debug:
    var: nexus_data
